@model IEnumerable<NoAuth.Models.Person>

@{
    ViewBag.Title = "Index";
}

<h2>People</h2>

@Html.ActionLink("Create New", "Create")

<div>
    <p>Search: <input type="text" placeholder="Search" id="searchString" /></p>
    <input type="submit" value="Filter" id="submit" />
</div>

<div id="people">
    <table>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    <img src = @item.ImagePath />
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.FirstName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.LastName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Address)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Age)
                </td>
            </tr>
        }
    </table>
</div>

@section scripts
{
    <script type="text/javascript">
        $(function () {
            $("#submit").click(function () {
                $.ajax({
                    type: "POST",
                    url: "/Person/Search",
                    data: '{ searchString: "' + $("#searchString").val() + '" }',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        var table = document.createElement('table');
                        var tbody = document.createElement('tbody');
                        
                        response.forEach(function (person) {
                            var tr = document.createElement('tr');
                            var img = document.createElement('img');
                            img.src = person.ImagePath;
                            tr.appendChild(img);
                            tr.appendChild(document.createTextNode(person.FirstName));
                            tr.appendChild(document.createTextNode(person.LastName));
                            tr.appendChild(document.createTextNode(person.Age));
                            tr.appendChild(document.createTextNode(person.Address));
                            tbody.appendChild(tr);
                        });
                        table.appendChild(tbody);
                        $('#people table').remove();
                        $('#people').append(table);
                    }
                });
            });
        });
    </script>
}